<!-- Contenedor principal con fondo y sombra suave -->
<div class="col-12 p-fluid">
    <p-fieldset legend="Actualización de Proveedor">
        <form [formGroup]="up" (ngSubmit)="guardar()">
            <div class="grid">
                <!-- Información Básica -->
                <div class="col-12 md:col-6">
                    <div class="p-2 border-round">
                        <h3 class="text-xl font-bold mb-4"><i class="pi pi-user mr-2"></i>Información Básica</h3>
                        <div class="field mb-5">
                            <span class="p-float-label">
                                <input id="prvRut" type="text" pInputText value="{{provedor.rut}}" disabled>
                                <label for="prvRut">RUT</label>
                            </span>
                            
                        </div>
                        <div class="field mb-5">
                            <span class="p-float-label">
                                <input id="prvNom" type="text" pInputText formControlName="prvNom"
                                    [ngClass]="{'was-validated': up.controls['prvNom'].touched && up.controls['prvNom'].invalid,
                                               'is-valid': up.controls['prvNom'].touched && up.controls['prvNom'].valid}">
                                <label for="prvNom">Nombre</label>
                            </span>
                            <div *ngIf="up.controls['prvNom'].touched" class="error-messages">
                                <span class="text-danger" *ngIf="up.controls['prvNom'].hasError('required')">
                                    El nombre es obligatorio
                                </span>
                            </div>
                        </div>
                        <div class="field mb-5">
                            <span class="p-float-label">
                                <input id="prvNom2" type="text" pInputText formControlName="prvNom2">
                                <label for="prvNom2">Nombre Alternativo</label>
                            </span>
                        </div>
                        <div class="field mb-5">
                            <span class="p-float-label">
                                <input id="prvGiro" type="text" pInputText formControlName="prvGiro"
                                    [ngClass]="{'was-validated': up.controls['prvGiro'].touched && up.controls['prvGiro'].invalid,
                                               'is-valid': up.controls['prvGiro'].touched && up.controls['prvGiro'].valid}">
                                <label for="prvGiro">Giro</label>
                            </span>
                            <div *ngIf="up.controls['prvGiro'].touched" class="error-messages">
                                <span class="text-danger" *ngIf="up.controls['prvGiro'].hasError('required')">
                                    El giro es obligatorio
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Información de Contacto -->
                <div class="col-12 md:col-6">
                    <div class="p-2 border-round">
                        <h3 class="text-xl font-bold mb-4"><i class="pi pi-phone mr-2"></i>Información de Contacto</h3>
                        <div class="field mb-5">
                            <span class="p-float-label">
                                <input id="prvTel" type="text" pInputText formControlName="prvTel"
                                    [ngClass]="{'was-validated': up.controls['prvTel'].touched && up.controls['prvTel'].invalid,
                                               'is-valid': up.controls['prvTel'].touched && up.controls['prvTel'].valid}">
                                <label for="prvTel">Teléfono</label>
                            </span>
                            <div *ngIf="up.controls['prvTel'].touched" class="error-messages">
                                <span class="text-danger" *ngIf="up.controls['prvTel'].hasError('required')">
                                    El teléfono es obligatorio
                                </span>
                                <span class="text-danger" *ngIf="up.controls['prvTel'].hasError('pattern')">
                                    El teléfono debe tener 9 dígitos
                                </span>
                            </div>
                        </div>
                        <div class="field mb-5">
                            <span class="p-float-label">
                                <input id="prvMail" type="email" pInputText formControlName="prvMail"
                                    [ngClass]="{'was-validated': up.controls['prvMail'].touched && up.controls['prvMail'].invalid,
                                               'is-valid': up.controls['prvMail'].touched && up.controls['prvMail'].valid}">
                                <label for="prvMail">Email</label>
                            </span>
                            <div *ngIf="up.controls['prvMail'].touched" class="error-messages">
                                <span class="text-danger" *ngIf="up.controls['prvMail'].hasError('required')">
                                    El email es obligatorio
                                </span>
                                <span class="text-danger" *ngIf="up.controls['prvMail'].hasError('email')">
                                    El email no es válido
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ubicación -->
                <div class="col-12">
                    <div class="p-2 border-round">
                        <h3 class="text-xl font-bold mb-4"><i class="pi pi-map-marker mr-2"></i>Ubicación</h3>
                        <div class="grid">
                            <div class="col-12 md:col-6 lg:col-3">
                                <div class="field mb-5">    
                                    <label for="paiId">País</label>
                                    <ng-select [items]="paises$ | async"
                                        bindLabel="paiDes"                                 
                                        placeholder="Seleccione País"  
                                        [ngClass]="{'was-validated': up.controls['paiId'].touched && up.controls['paiId'].invalid,
                                                   'is-valid': up.controls['paiId'].touched && up.controls['paiId'].valid}"
                                        formControlName="paiId">                                           
                                    </ng-select>
                                    <div *ngIf="up.controls['paiId'].touched" class="error-messages">
                                        <span class="text-danger" *ngIf="up.controls['paiId'].hasError('required')">
                                            El país es obligatorio
                                        </span>
                                    </div>
                                </div>
                            </div>

                            <div class="col-12 md:col-6 lg:col-3">
                                <div class="field mb-5">           
                                    <label for="regId">Región</label>
                                    <ng-select [items]="regiones$ | async"
                                        bindLabel="regDes"                              
                                        placeholder="Seleccione Región"  
                                        [ngClass]="{'was-validated': up.controls['regId'].touched && up.controls['regId'].invalid,
                                                   'is-valid': up.controls['regId'].touched && up.controls['regId'].valid}"
                                        formControlName="regId">
                                    </ng-select>
                                    <div *ngIf="up.controls['regId'].touched" class="error-messages">
                                        <span class="text-danger" *ngIf="up.controls['regId'].hasError('required')">
                                            La región es obligatoria
                                        </span>
                                    </div>
                                </div>
                            </div>

                            <div class="col-12 md:col-6 lg:col-3">
                                <div class="field mb-5">
                                    <label for="ciuId">Ciudad</label>
                                    <ng-select [items]="ciudades$ | async"
                                        bindLabel="ciuDes"                                     
                                        placeholder="Seleccione Ciudad"  
                                        [ngClass]="{'was-validated': up.controls['ciuId'].touched && up.controls['ciuId'].invalid,
                                                   'is-valid': up.controls['ciuId'].touched && up.controls['ciuId'].valid}"
                                        formControlName="ciuId">
                                    </ng-select>
                                    <div *ngIf="up.controls['ciuId'].touched" class="error-messages">
                                        <span class="text-danger" *ngIf="up.controls['ciuId'].hasError('required')">
                                            La ciudad es obligatoria
                                        </span>
                                    </div>
                                </div>
                            </div>

                            <div class="col-12 md:col-6 lg:col-3">
                                <div class="field mb-5">
                                    <label for="comId">Comuna</label>
                                    <ng-select [items]="comunas$ | async"
                                        bindLabel="comDes"                             
                                        placeholder="Seleccione Comuna"  
                                        [ngClass]="{'was-validated': up.controls['comId'].touched && up.controls['comId'].invalid,
                                                   'is-valid': up.controls['comId'].touched && up.controls['comId'].valid}"
                                        formControlName="comId">
                                    </ng-select>
                                    <div *ngIf="up.controls['comId'].touched" class="error-messages">
                                        <span class="text-danger" *ngIf="up.controls['comId'].hasError('required')">
                                            La comuna es obligatoria
                                        </span>
                                    </div>
                                </div>
                            </div>

                            <div class="col-12">
                                <div class="field mb-5">
                                    <label for="prvDir">Dirección</label>
                                    <input #prvDir id="prvDir" type="text" pInputText formControlName="prvDir" 
                                        class="w-full" placeholder="Ingrese una dirección">
                                </div>
                                <div class="map-container">
                                    <div #map style="width: 100%; height: 300px;" class="border-round"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tipo -->
                <div class="col-12">
                    <div class="p-2 border-round">
                        <h3 class="text-xl font-bold mb-4"><i class="pi pi-tag mr-2"></i>Tipo</h3>    
                        <div class="grid">
                            <div class="col-12 md:col-6">
                                <div class="field-checkbox">
                                    <p-checkbox formControlName="prvCli" [binary]="true" inputId="prvCli"></p-checkbox>
                                    <label for="prvCli" class="ml-2">Es Cliente</label>
                                </div>
                            </div>
                            <div class="col-12 md:col-6">
                                <div class="field-checkbox">
                                    <p-checkbox formControlName="prvPrv" [binary]="true" inputId="prvPrv"></p-checkbox>
                                    <label for="prvPrv" class="ml-2">Es Proveedor</label>
                                </div>
                            </div>
                            <div class="col-12 md:col-6">
                                <div class="field-checkbox">
                                    <p-checkbox formControlName="prvAct" [binary]="true" inputId="prvAct"></p-checkbox>
                                    <label for="prvAct" class="ml-2">Activo</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Botones de Acción -->
            <div class="flex flex-wrap gap-2 align-items-center mt-3">
                <p-button type="submit" label="Guardar" icon="pi pi-check" size="small" 
                    [loading]="loading" *ngIf="up.valid"/>
                <p-button label="Volver" icon="pi pi-arrow-down" size="small" (click)="onCancel()" severity="secondary"/>
            </div>
        </form>
    </p-fieldset>
</div>
